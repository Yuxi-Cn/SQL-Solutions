3214. Year on Year Growth Rate

T-SQL Solution:

with curr_year as (
    select 
          year(cast(transaction_date as date)) as year,
          product_id,
          sum(spend) as curr_year_spend
    from user_transactions
    group by year(cast(transaction_date as date)), product_id
)
, prev_year as (
    select 
          year(cast(transaction_date as date)) as year,
          product_id,
          sum(spend) as prev_year_spend
    from user_transactions
    group by year(cast(transaction_date as date)), product_id
)
select
      a.year,
      a.product_id,
      a.curr_year_spend,
      b.prev_year_spend,
      round(
        (a.curr_year_spend - b.prev_year_spend) / b.prev_year_spend
        * 100, 2) as yoy_rate
from curr_year a 
left join prev_year b on a.product_id = b.product_id
                      and a.year = b.year + 1
order by a.product_id, a.year
